# Subsocial squid

#### Indexer for work with both Subsocial and Soonsocial chains. 

## Quick running

```bash
# 1. Update Squid SDK and install dependencies
npm run update
npm ci
# 2. Compile typescript files
make build
# 3. Start target Postgres database and detach
make up

# 4. Set env variable for specifying target blockchain
export CHAIN=subsocial # if you need rung indexer for subsocial network
# or
export CHAIN=soonsocial # if you need rung indexer for soonsocial network

# 5. Start the processor
make process
# 6. The command above will block the terminal
#    being busy with fetching the chain data, 
#    transforming and storing it in the target database.
#
#    To start the graphql server open the separate terminal
#    and run
make serve
```

### Short info about indexer multi-chain structure

1. Chain configs/endpoints can be configured in `config.ts` file in appropriate folder of necessary chain:
    - Subsocial - `src/chains/subsocial/config.ts`
    - Soonsocial - `src/chains/soonsocial/config.ts`
2. Necessary events/calls/storage calls can be configured for each chain in appropriate file in `/typegen` folder.
3. Command `make typegen` uses custom [shel script](./scripts/typegen.sh) which generates types for each chain defined in `/typegen` folder.
4. Chain sensitive logic is implemented in sub-folder with appropriate name in `/src/chains` folder. 
It's required because each chain has it's own bunch of specs and as result it's own autogenerated types.
Chain sensitive logic:
   - parsing events data
   - parsing calls data
   - making storage calls
5. Indexer can be deployed to Aquarium to 2 different squids with 2 separate deployment manifests:
   - Subsocial - [./squid-subsocial.yaml](./squid-subsocial.yaml)
   - Soonsocial - [./squid-soonsocial.yaml](./squid-soonsocial.yaml)
   